<!-- Common Lisp HyperSpec (TM), version 7.0 generated by Kent M. Pitman on Mon, 11-Apr-2005 2:31am EDT -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">

<html>
<head>
<title>
      CLHS: Section 6.1.3
    </title>
<link href="../Data/clhs.css" rel="stylesheet" type="text/css"/>
<meta content="Kent M. Pitman" http-equiv="Author"/>
<meta content="LispWorks Ltd." http-equiv="Organization"/>
<link href="../Front/index.htm" rel="TOP"/>
<link href="../Front/Help.htm#Legal" rel="COPYRIGHT"/>
<link href="../Front/Help.htm#Disclaimer" rel="DISCLAIMER"/>
<link href="06_abba.htm" rel="PREV"/>
<link href="06_a.htm" rel="UP"/>
<link href="06_aca.htm" rel="NEXT"/>
</head>
<body>
<h1>
<a href="http://www.lispworks.com/" rev="MADE"><img align="bottom" alt="[LISPWORKS]" height="65" src="../Graphics/LWSmall.gif" width="80"/></a><a href="../Front/index.htm" rel="TOP"><img align="bottom" alt="[Common Lisp HyperSpec (TM)]" height="65" src="../Graphics/CLHS_Sm.gif" width="237"/></a> <a href="06_abba.htm" rel="PREV"><img align="bottom" alt="[Previous]" height="40" src="../Graphics/Prev.gif" width="40"/></a><a href="06_a.htm" rel="UP"><img align="bottom" alt="[Up]" height="40" src="../Graphics/Up.gif" width="40"/></a><a href="06_aca.htm" rel="NEXT"><img align="bottom" alt="[Next]" height="40" src="../Graphics/Next.gif" width="40"/></a>
</h1>
<hr/>
<h2>
      6.1.3 Value Accumulation Clauses
    </h2>
<p>
      The constructs <tt>collect</tt>, <tt>collecting</tt>,
      <tt>append</tt>, <tt>appending</tt>, <tt>nconc</tt>,
      <tt>nconcing</tt>, <tt>count</tt>, <tt>counting</tt>,
      <tt>maximize</tt>, <tt>maximizing</tt>, <tt>minimize</tt>,
      <tt>minimizing</tt>, <tt>sum</tt>, and <tt>summing</tt>,
      allow values to be accumulated in a <a href="m_loop.htm#loop" rel="DEFINITION"><b>loop</b></a>.
    </p>
<p>
      The constructs <tt>collect</tt>, <tt>collecting</tt>,
      <tt>append</tt>, <tt>appending</tt>, <tt>nconc</tt>, and
      <tt>nconcing</tt>, designate clauses that accumulate values
      in <a href="26_glo_l.htm#list" rel="DEFINITION"><i>lists</i></a> and return them. The
      constructs <tt>count</tt>, <tt>counting</tt>,
      <tt>maximize</tt>, <tt>maximizing</tt>, <tt>minimize</tt>,
      <tt>minimizing</tt>, <tt>sum</tt>, and <tt>summing</tt>
      designate clauses that accumulate and return numerical
      values.
    </p>
<p>
      During each iteration, the constructs <tt>collect</tt> and
      <tt>collecting</tt> collect the value of the supplied
      <i>form</i> into a <a href="26_glo_l.htm#list" rel="DEFINITION"><i>list</i></a>. When iteration
      terminates, the <a href="26_glo_l.htm#list" rel="DEFINITION"><i>list</i></a> is returned. The argument
      <i>var</i> is set to the <a href="26_glo_l.htm#list" rel="DEFINITION"><i>list</i></a> of collected values; if
      <i>var</i> is supplied, the <a href="m_loop.htm#loop" rel="DEFINITION"><b>loop</b></a> does not return the final
      <a href="26_glo_l.htm#list" rel="DEFINITION"><i>list</i></a>
      automatically. If <i>var</i> is not supplied, it is
      equivalent to supplying an internal name for <i>var</i> and
      returning its value in a <tt>finally</tt> clause. The
      <i>var</i> argument is bound as if by the construct
      <tt>with</tt>. No mechanism is provided for declaring the
      <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a>
      of <i>var</i>; it must be of <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> <a href="t_list.htm#list" rel="DEFINITION"><b>list</b></a>.
    </p>
<p>
      The constructs <tt>append</tt>, <tt>appending</tt>,
      <tt>nconc</tt>, and <tt>nconcing</tt> are similar to
      <tt>collect</tt> except that the values of the supplied
      <i>form</i> must be <a href="26_glo_l.htm#list" rel="DEFINITION"><i>lists</i></a>.
    </p>
<p></p>
<p></p>
<dl>
<dt>
        * The <tt>append</tt> keyword causes its <a href="26_glo_l.htm#list" rel="DEFINITION"><i>list</i></a>
        values to be concatenated into a single <a href="26_glo_l.htm#list" rel="DEFINITION"><i>list</i></a>, as if they were
        arguments to the <a href="26_glo_f.htm#function" rel="DEFINITION"><i>function</i></a> <a href="f_append.htm#append" rel="DEFINITION"><b>append</b></a>.<br/>
</dt>
<dd></dd>
<dt>
        * The <tt>nconc</tt> keyword causes its <a href="26_glo_l.htm#list" rel="DEFINITION"><i>list</i></a> values to be
        concatenated into a single <a href="26_glo_l.htm#list" rel="DEFINITION"><i>list</i></a>, as if they were
        arguments to the <a href="26_glo_f.htm#function" rel="DEFINITION"><i>function</i></a> <a href="f_nconc.htm#nconc" rel="DEFINITION"><b>nconc</b></a>.<br/>
</dt>
<dd></dd>
</dl>
<p>
      The argument <i>var</i> is set to the <a href="26_glo_l.htm#list" rel="DEFINITION"><i>list</i></a> of concatenated
      values; if <i>var</i> is supplied, <a href="m_loop.htm#loop" rel="DEFINITION"><b>loop</b></a> does not return the final
      <a href="26_glo_l.htm#list" rel="DEFINITION"><i>list</i></a>
      automatically. The <i>var</i> argument is bound as if by the
      construct <tt>with</tt>. A <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> cannot be supplied for
      <i>var</i>; it must be of <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> <a href="t_list.htm#list" rel="DEFINITION"><b>list</b></a>. The construct
      <tt>nconc</tt> destructively modifies its argument <a href="26_glo_l.htm#list" rel="DEFINITION"><i>lists</i></a>.
    </p>
<p>
      The <tt>count</tt> construct counts the number of times that
      the supplied <i>form</i> returns <a href="26_glo_t.htm#true" rel="DEFINITION"><i>true</i></a>. The argument <i>var</i>
      accumulates the number of occurrences; if <i>var</i> is
      supplied, <a href="m_loop.htm#loop" rel="DEFINITION"><b>loop</b></a> does not return the final
      count automatically. The <i>var</i> argument is bound as if
      by the construct <tt>with</tt> to a zero of the appropriate
      type. Subsequent values (including any necessary coercions)
      are computed as if by the function <a href="f_1pl_1_.htm#1PL" rel="DEFINITION"><b>1+</b></a>. If <tt>into</tt> <i>var</i>
      is used, a <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> can be supplied for
      <i>var</i> with the <i>type-spec</i> argument; the
      consequences are unspecified if a nonnumeric <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> is
      supplied. If there is no <tt>into</tt> variable, the optional
      <i>type-spec</i> argument applies to the internal variable
      that is keeping the count. The default <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> is <a href="26_glo_i.htm#implementation-dependent" rel="DEFINITION"><i>implementation-dependent</i></a>;
      but it must be a <a href="26_glo_s.htm#supertype" rel="DEFINITION"><i>supertype</i></a> of <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> <a href="t_fixnum.htm#fixnum" rel="DEFINITION"><b>fixnum</b></a>.
    </p>
<p>
      The <tt>maximize</tt> and <tt>minimize</tt> constructs
      compare the value of the supplied <i>form</i> obtained during
      the first iteration with values obtained in successive
      iterations. The maximum (for <tt>maximize</tt>) or minimum
      (for <tt>minimize</tt>) value encountered is determined (as
      if by the <a href="26_glo_f.htm#function" rel="DEFINITION"><i>function</i></a> <a href="f_max_m.htm#max" rel="DEFINITION"><b>max</b></a> for
      <tt>maximize</tt> and as if by the <a href="26_glo_f.htm#function" rel="DEFINITION"><i>function</i></a> <a href="f_max_m.htm#min" rel="DEFINITION"><b>min</b></a> for
      <tt>minimize</tt>) and returned. If the <tt>maximize</tt> or
      <tt>minimize</tt> clause is never executed, the accumulated
      value is unspecified. The argument <i>var</i> accumulates the
      maximum or minimum value; if <i>var</i> is supplied, <a href="m_loop.htm#loop" rel="DEFINITION"><b>loop</b></a> does not
      return the maximum or minimum automatically. The <i>var</i>
      argument is bound as if by the construct <tt>with</tt>. If
      <tt>into</tt> <i>var</i> is used, a <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> can be supplied for
      <i>var</i> with the <i>type-spec</i> argument; the
      consequences are unspecified if a nonnumeric <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> is
      supplied. If there is no <tt>into</tt> variable, the optional
      <i>type-spec</i> argument applies to the internal variable
      that is keeping the maximum or minimum value. The default
      <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a>
      is <a href="26_glo_i.htm#implementation-dependent" rel="DEFINITION"><i>implementation-dependent</i></a>;
      but it must be a <a href="26_glo_s.htm#supertype" rel="DEFINITION"><i>supertype</i></a> of <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> <a href="t_real.htm#real" rel="DEFINITION"><b>real</b></a>.
    </p>
<p>
      The <tt>sum</tt> construct forms a cumulative sum of the
      successive <a href="26_glo_p.htm#primary_value" rel="DEFINITION"><i>primary values</i></a> of the
      supplied <i>form</i> at each iteration. The argument
      <i>var</i> is used to accumulate the sum; if <i>var</i> is
      supplied, <a href="m_loop.htm#loop" rel="DEFINITION"><b>loop</b></a> does not return the final
      sum automatically. The <i>var</i> argument is bound as if by
      the construct <tt>with</tt> to a zero of the appropriate
      type. Subsequent values (including any necessary coercions)
      are computed as if by the <a href="26_glo_f.htm#function" rel="DEFINITION"><i>function</i></a> <a href="f_pl.htm#PL" rel="DEFINITION"><b>+</b></a>. If
      <tt>into</tt> <i>var</i> is used, a <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> can be supplied for
      <i>var</i> with the <i>type-spec</i> argument; the
      consequences are unspecified if a nonnumeric <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> is
      supplied. If there is no <tt>into</tt> variable, the optional
      <i>type-spec</i> argument applies to the internal variable
      that is keeping the sum. The default <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> is <a href="26_glo_i.htm#implementation-dependent" rel="DEFINITION"><i>implementation-dependent</i></a>;
      but it must be a <a href="26_glo_s.htm#supertype" rel="DEFINITION"><i>supertype</i></a> of <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> <a href="t_number.htm#number" rel="DEFINITION"><b>number</b></a>.
    </p>
<p>
      If <tt>into</tt> is used, the construct does not provide a
      default return value; however, the variable is available for
      use in any <tt>finally</tt> clause.
    </p>
<p>
      Certain kinds of accumulation clauses can be combined in a
      <a href="m_loop.htm#loop" rel="DEFINITION"><b>loop</b></a> if
      their destination is the same (the result of <a href="m_loop.htm#loop" rel="DEFINITION"><b>loop</b></a> or an
      <tt>into</tt> <i>var</i>) because they are considered to
      accumulate conceptually compatible quantities. In particular,
      any elements of following sets of accumulation clauses can be
      mixed with other elements of the same set for the same
      destination in a <a href="m_loop.htm#loop" rel="DEFINITION"><b>loop</b></a> <a href="26_glo_f.htm#form" rel="DEFINITION"><i>form</i></a>:
    </p>
<p></p>
<p></p>
<dl>
<dt>
        * <tt>collect</tt>, <tt>append</tt>, <tt>nconc</tt><br/>
</dt>
<dd></dd>
<dt>
        * <tt>sum</tt>, <tt>count</tt><br/>
</dt>
<dd></dd>
<dt>
        * <tt>maximize</tt>, <tt>minimize</tt><br/>
</dt>
<dd></dd>
</dl>
<p></p>
<pre>
;; Collect every name and the kids in one list by using 
;; COLLECT and APPEND.
 (loop for name in '(fred sue alice joe june)
       for kids in '((bob ken) () () (kris sunshine) ())
       collect name
       append kids)
=&gt;  (FRED BOB KEN SUE ALICE JOE KRIS SUNSHINE JUNE)
</pre>
<p>
      Any two clauses that do not accumulate the same <a href="26_glo_t.htm#type" rel="DEFINITION"><i>type</i></a> of
      <a href="26_glo_o.htm#object" rel="DEFINITION"><i>object</i></a> can coexist in a
      <a href="m_loop.htm#loop" rel="DEFINITION"><b>loop</b></a>
      only if each clause accumulates its values into a different
      <a href="26_glo_v.htm#variable" rel="DEFINITION"><i>variable</i></a>.
    </p>
<p></p>
<h2>
<a href="06_aca.htm" rel="CHILD">6.1.3.1 Examples of COLLECT
      clause</a>
</h2><p></p><pre>
;; Collect all the symbols in a list.
 (loop for i in '(bird 3 4 turtle (1 . 4) horse cat)
       when (symbolp i) collect i)
=&gt;  (BIRD TURTLE HORSE CAT)
 
;; Collect and return odd numbers.
 (loop for i from 1 to 10
       if (oddp i) collect i)
=&gt;  (1 3 5 7 9)
 
;; Collect items into local variable, but don't return them.
 (loop for i in '(a b c d) by #'cddr
       collect i into my-list
       finally (print my-list))
&gt;&gt;  (A C) 
=&gt;  NIL
</pre><p></p><h2>
      6.1.3.1 Examples of COLLECT clause
    </h2>
<p></p>
<h2>
<a href="06_acb.htm" rel="CHILD">6.1.3.2 Examples of APPEND
      and NCONC clauses</a>
</h2>
<p></p>
<h2>
<a href="06_acc.htm" rel="CHILD">6.1.3.3 Examples of COUNT
      clause</a>
</h2>
<p></p>
<h2>
<a href="06_acd.htm" rel="CHILD">6.1.3.4 Examples of MAXIMIZE
      and MINIMIZE clauses</a>
</h2>
<p></p>
<h2>
<a href="06_ace.htm" rel="CHILD">6.1.3.5 Examples of SUM
      clause</a>
</h2>
<p></p>
<hr/>
<a href="../Front/StartPts.htm" rel="NAVIGATOR"><img align="bottom" alt="[Starting Points]" height="40" src="../Graphics/StartPts.gif" width="80"/></a><a href="../Front/Contents.htm" rel="TOC"><img align="bottom" alt="[Contents]" height="40" src="../Graphics/Contents.gif" width="80"/></a><a href="../Front/X_Master.htm" rel="INDEX"><img align="bottom" alt="[Index]" height="40" src="../Graphics/Index.gif" width="80"/></a><a href="../Front/X_Symbol.htm" rel="INDEX"><img align="bottom" alt="[Symbols]" height="40" src="../Graphics/Symbols.gif" width="80"/></a><a href="../Body/26_a.htm" rel="GLOSSARY"><img align="bottom" alt="[Glossary]" height="40" src="../Graphics/Glossary.gif" width="80"/></a><a href="../Front/X3J13Iss.htm"><img align="bottom" alt="[Issues]" height="40" src="../Graphics/Issues.gif" width="80"/></a><br/>
<a href="../Front/Help.htm#Legal" rel="COPYRIGHT"><i>Copyright
    1996-2005, LispWorks Ltd. All rights reserved.</i></a>
<p></p>
</body>
</html>
